<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Design at a Glance - Zcash Trailing Finality Layer</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../introduction/tfl-in-zcashs-evolution.html"><strong aria-hidden="true">1.1.</strong> TFL in Zcash's Evolution</a></li><li class="chapter-item expanded "><a href="../introduction/status-and-next-steps.html"><strong aria-hidden="true">1.2.</strong> Status and Next Steps</a></li><li class="chapter-item expanded "><a href="../introduction/motivating-finality.html"><strong aria-hidden="true">1.3.</strong> Motivating Finality</a></li><li class="chapter-item expanded "><a href="../introduction/visualizing-trailing-finality.html"><strong aria-hidden="true">1.4.</strong> Visualizing Trailing Finality</a></li><li class="chapter-item expanded "><a href="../introduction/get-involved.html"><strong aria-hidden="true">1.5.</strong> Get Involved</a></li></ol></li><li class="chapter-item expanded "><a href="../terminology.html"><strong aria-hidden="true">2.</strong> Terminology</a></li><li class="chapter-item expanded "><a href="../overview.html"><strong aria-hidden="true">3.</strong> Overview</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../overview/design-at-a-glance.html" class="active"><strong aria-hidden="true">3.1.</strong> Design at a Glance</a></li><li class="chapter-item expanded "><a href="../overview/subprotocol-interface.html"><strong aria-hidden="true">3.2.</strong> Subprotocol Interface</a></li><li class="chapter-item expanded "><a href="../overview/model-code-architecture.html"><strong aria-hidden="true">3.3.</strong> Model Code Architecture</a></li><li class="chapter-item expanded "><a href="../overview/network-architecture.html"><strong aria-hidden="true">3.4.</strong> Network Architecture (TBD)</a></li></ol></li><li class="chapter-item expanded "><a href="../protocol-specification.html"><strong aria-hidden="true">4.</strong> Protocol Specification (TBD)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../protocol-specification/abstract-protocol.html"><strong aria-hidden="true">4.1.</strong> Abstract Protocol (TBD)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../protocol-specification/abstract-protocol/token-dynamics.html"><strong aria-hidden="true">4.1.1.</strong> Token Dynamics (TBD)</a></li></ol></li><li class="chapter-item expanded "><a href="../protocol-specification/concrete-protocol.html"><strong aria-hidden="true">4.2.</strong> Concrete Protocol (TBD)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../protocol-specification/concrete-protocol/token-dynamics.html"><strong aria-hidden="true">4.2.1.</strong> Token Dynamics (TBD)</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../security.html"><strong aria-hidden="true">5.</strong> Security (TBD)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../security/abstract-analysis.html"><strong aria-hidden="true">5.1.</strong> Abstract Analysis (TBD)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../security/abstract-analysis/ebb-and-flow-analysis.html"><strong aria-hidden="true">5.1.1.</strong> Ebb-and-Flow analysis (TBD)</a></li><li class="chapter-item expanded "><a href="../security/abstract-analysis/subprotocol-compromise-analysis.html"><strong aria-hidden="true">5.1.2.</strong> Subprotocol Compromise Analysis (TBD)</a></li><li class="chapter-item expanded "><a href="../security/abstract-analysis/model-code-architecture-analysis.html"><strong aria-hidden="true">5.1.3.</strong> Model Code Architecture Analysis (TBD)</a></li><li class="chapter-item expanded "><a href="../security/abstract-analysis/network-architecture-analysis.html"><strong aria-hidden="true">5.1.4.</strong> Network Architecture Analysis (TBD)</a></li></ol></li><li class="chapter-item expanded "><a href="../security/concrete-analysis.html"><strong aria-hidden="true">5.2.</strong> Concrete Analysis (TBD)</a></li></ol></li><li class="chapter-item expanded "><a href="../references.html"><strong aria-hidden="true">6.</strong> References</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Zcash Trailing Finality Layer</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="design-at-a-glance"><a class="header" href="#design-at-a-glance">Design at a Glance</a></h1>
<p>The PoW+TFL consenus protocol is logically an extension of the Zcash consensus rules to introduce <em>trailing finality</em>. This is achieved by compartmentalizing the top-level PoW+TFL protocol into two <em>subprotocols</em>, one embodying most of the current consensus logic of Zcash and the TFL. These subprotocols interace through a strictly defined message-passing system called the <em>Subprotocol Interface</em>. (Remember to refer to <a href="../terminology.html">Terminology</a> to clarify terms.)</p>
<p><strong>TODO:</strong> Add consensus subprotocol diagram.</p>
<h2 id="subprotocols"><a class="header" href="#subprotocols">Subprotocols</a></h2>
<p>The PoW+TFL hybrid consensus consists of two interacting subprotocols:</p>
<ol>
<li><em>PoW Subprotocol</em>: this subprotocol is very similar to NU5 consensus. It is a design goal of the TFL design to minimize changes to this subprotocol. Note: the shorthand &quot;PoW&quot; is potentially misleading, because this subprotocol is also responsible for the bulk of all supply and transaction semantic consensus rules.</li>
<li><em>TFL Subprotocol</em>: this is a new subprotocol which provides trailing finality via a finalizing PoS protocol.</li>
</ol>
<p>Validators must operate both subprotocols in an integrated manner. These subprotocols follow the design layed out in <a href="../references.html#ebb-and-flow-protocols">Ebb-and-Flow design</a>.</p>
<h2 id="design-analysis-focus-areas"><a class="header" href="#design-analysis-focus-areas">Design Analysis Focus Areas</a></h2>
<p>Analyzing this design focuses on four areas:</p>
<ul>
<li>The design of each subprotocol independently,</li>
<li>The interaction between the two subprotocols idealized as an interface between subcomponents, and</li>
<li>The whole as an integrated system.</li>
</ul>
<h2 id="consensus"><a class="header" href="#consensus">Consensus</a></h2>
<p>Consensus is specified in terms of the sub-consensus of each of the two subprotocols, PoW &amp; TFL, along with the interface between the two, and finally in terms of system-wide / integrated consensus rules.</p>
<p>We also explicitly define design goals about which areas of consensus <em>must not</em> be impacted by a transition from NU5 to PoW+TFL.</p>
<h3 id="trailing-finality"><a class="header" href="#trailing-finality">Trailing Finality</a></h3>
<p>The TFL extends the Zcash consensus protocol with <em>Trailing Finality</em>: TFL <em>finalizes</em> blocks that have been produced by PoW. See <a href="../introduction/visualizing-trailing-finality.html">Visualizing Trailing Finality</a> for an informal description of this.</p>
<p>When focusing on the PoW subprotocol, Trailing Finality introduces minimal changes to the subprotocol consensus: PoW has a mechanism for discovering block finality from TFL, and then it introduces a single new PoW subprotocol consensus rule constraint:</p>
<blockquote>
<p>Rollbacks must not include any final blocks; equivalently: the best PoW chain must include all known final blocks.</p>
</blockquote>
<p>There are no other changes to PoW subprotocol consensus specific to trailing finality, including no changes to any ledger rules about balances, transaction semantics, etc…</p>
<h3 id="proof-of-stake"><a class="header" href="#proof-of-stake">Proof-of-Stake</a></h3>
<p>In order to achieve consensus on finality, the TFL uses a PoS protocol which provides absolute finality.</p>
<p>The PoS consensus area is where the bulk of complexity lies in terms of the interface between the PoW and PoS subprotocols because PoW, which is generally responsible for supply and transaction semantics. See <a href="#the-subprotocol-interface">The Subprotocol Interface</a> below for more detail.</p>
<h1 id="footnotes"><a class="header" href="#footnotes">Footnotes</a></h1>
<div class="footnote-definition" id="new-mainnet-precursors"><sup class="footnote-definition-label">1</sup>
<p>If new consensus changes are deployed to Zcash mainnet prior to PoW+TFL design finalization, this design must be updated to refer to the new delta (e.g. by reanalyzing all changes against NU6 or NU7, etc…)</p>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../overview.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../overview/subprotocol-interface.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../overview.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../overview/subprotocol-interface.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
