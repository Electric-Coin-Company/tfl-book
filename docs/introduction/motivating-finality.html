<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Motivating Finality - Zcash Trailing Finality Layer</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../introduction/motivating-finality.html" class="active"><strong aria-hidden="true">1.1.</strong> Motivating Finality</a></li><li class="chapter-item expanded "><a href="../introduction/visualizing-trailing-finality.html"><strong aria-hidden="true">1.2.</strong> Visualizing Trailing Finality</a></li></ol></li><li class="chapter-item expanded "><a href="../overview.html"><strong aria-hidden="true">2.</strong> Overview</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../overview/design-at-a-glance.html"><strong aria-hidden="true">2.1.</strong> Design at a Glance</a></li><li class="chapter-item expanded "><a href="../overview/subprotocol-interface.html"><strong aria-hidden="true">2.2.</strong> Subprotocol Interface</a></li><li class="chapter-item expanded "><a href="../overview/model-code-architecture.html"><strong aria-hidden="true">2.3.</strong> Model Code Architecture</a></li></ol></li><li class="chapter-item expanded "><a href="../references.html"><strong aria-hidden="true">3.</strong> References</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Zcash Trailing Finality Layer</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="motivating-finality"><a class="header" href="#motivating-finality">Motivating Finality</a></h1>
<p>In Zcash currently, consensus relies solely on PoW, which only provides <em>probabilistic finality</em>, rather than <em>guaranteed finality</em>.<sup class="footnote-reference"><a href="#finality-qualifiers">1</a></sup> This style of consensus does not offer a guarantee that any given block may not be <em>rolled back</em> which may invalidate the transactions it contains. Instead, the probability that a block may be rolled back decreases as more blocks are mined subsquently on top of it.</p>
<p>Let's walk through an example of how Zcash's current PoW with probabilistic finality can impede important use cases. Consider a PoW node which sees this block sequence at time <code>T=0</code>:</p>
<p><img src="motivating_finality_0.generated.svg" alt="" /></p>
<p>When should a user, wallet, or other system choose to act based on a transaction in a block?</p>
<p>For this example, let's assume a bridging system may have received a deposit for <code>ZEC</code> in block <code>f</code> and issued a corresponding number of proxy tokens on a different network.</p>
<p>At a later time, <code>T=1</code>, this same node may see a longer PoW chain which invalidates some previously seen blocks:</p>
<p><img src="motivating_finality_1.generated.svg" alt="" /></p>
<p>The node has observed a longer chain ending at block <code>h'</code>, so PoW consensus calls for that new sequence to be treated as consensus. The previously seen blocks <code>f</code> and <code>g</code> are no longer part of the consensus history, and have been rolled back.</p>
<h2 id="impact-of-the-rollback"><a class="header" href="#impact-of-the-rollback">Impact of the Rollback</a></h2>
<p>In our example, the bridging system acted in response to a transaction in the original block <code>f</code> at <code>T=0</code>. If the new sequence ending at <code>h'</code> no longer contains the deposit to the bridging system, the integrity of the bridge has been violated<sup class="footnote-reference"><a href="#txn-rollback">2</a></sup>; the associated proxy tokens may have already been used in a complex chain of Defi applications or deposited onto an exchange and sold, which would make any recovery impossible. The proxy tokens on the other network no longer correspond to the correct amount of <code>ZEC</code> on the Zcash network.</p>
<h2 id="rollback-complications"><a class="header" href="#rollback-complications">Rollback Complications</a></h2>
<p>This example demonstrates how a lack of guaranteed finality can impede many useful real-world scenarios. In practice, systems and services which need greater assurances wait for more block confirmations.</p>
<p>This has several drawbacks:</p>
<ul>
<li>it <em>doesn't remove the vulnerability</em>, it only reduces the likelihood,</li>
<li>different applications may require different block depths making it difficult to compose or chain together different applications and potentially confusing users, and</li>
<li>it introduces a delay which inhibits many useful applications.</li>
</ul>
<p>In addition to these user-facing and economic drawbacks, correctly handling rollbacks makes the code for nodes, wallets, and other infrastructure more complex. Worse still, many systems may not have correct behavior for rollbacks at different depths, and since large rollbacks are rarer, these implementation flaws may not surface until there is a large rollback. A large rollback would be disruptive all by itself, and becomes even worse when previously undiscovered bugs exacerbate the situations.</p>
<h2 id="trailing-finality-benefits"><a class="header" href="#trailing-finality-benefits">Trailing Finality Benefits</a></h2>
<p>Trailing finality extends the existing PoW consensus so that older blocks become final, ensuring they <em>cannot</em> be rolled back, and by extension neither can any of the transactions they containt.</p>
<p>This directly addresses the first two flaws above: it completely removes the vulnerability and it ensures all systems which need finality behave consistently with each other.</p>
<p>As for delay, tailing finality also introduces delay since final blocks &quot;trail behind&quot; the most recent PoW blocks. This can be an improvement for some applications, but not others. For example, if the delay to finality averages around 10 minutes, then this would enable an improvement for an exchange which requires 60 minutes of PoW blocks for a deposit. On the other hand, it would not be an improvement for an application that needs finality faster than 10 minutes.</p>
<p>Finally, implementations can be simplified by relying on the guarantee of finality in a manner of ways.</p>
<h1 id="footnotes"><a class="header" href="#footnotes">Footnotes</a></h1>
<div class="footnote-definition" id="finality-qualifiers"><sup class="footnote-definition-label">1</sup>
<p>Throughout this book, when we say <em>finality</em> or <em>final</em> without other qualifiers, we specifically are referring to <em>guaranteed finality</em> or a <em>guaranteed final</em> block. Where we call out <em>probabalistic finality</em> we always use that qualifier.</p>
</div>
<div class="footnote-definition" id="txn-rollback"><sup class="footnote-definition-label">2</sup>
<p>This discussion simplifies consideration of <em>transaction rollback</em> vs <em>block rollback</em>. When a block is rolled back, it is possible for some of the transactions contained in it to appear in new canonical blocks. The conditions when this can occur vs when it cannot are multifaceted and also subject to malicious influence, so for simplicity we assume all transactions within a rolled-back block are also rolled back.</p>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../introduction.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../introduction/visualizing-trailing-finality.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../introduction.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../introduction/visualizing-trailing-finality.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
